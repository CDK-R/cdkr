<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handling Molecular Formulae • rcdk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Handling Molecular Formulae">
<meta property="og:description" content="rcdk">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcdk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.5.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/molform.html">Handling Molecular Formulae</a>
    </li>
    <li>
      <a href="../articles/using-rcdk.html">Using the CDK from R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="molform_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Handling Molecular Formulae</h1>
                        <h4 class="author">Rajarshi Guha</h4>
            
            <h4 class="date">2020-12-29</h4>
      
      
      <div class="hidden name"><code>molform.Rmd</code></div>

    </div>

    
    
<div id="handling-molecular-formulae" class="section level1">
<h1 class="hasAnchor">
<a href="#handling-molecular-formulae" class="anchor"></a>Handling Molecular Formulae</h1>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The molecular formula is the simplest way to characterize a molecular compound. It specifies the actual number of atoms of each element contained in the molecule. A molecular formula is represented by the chemical symbol of each constituent element. If a molecule contains more than one atom for a particular element, the quantity is shown as subscript after the chemical symbol. Otherwise, the number of neutrons (atomic mass) that an atom is composed can differ. This different type of atoms are known as isotopes. The number of nuclei is represented as superscripted prefix previous to the chemical element. Generally it is not added when the isotope that characterizes the element is the most occurrence in nature, e.g., <span class="math inline">\(C_4H_{11}O^2D\)</span>.</p>
</div>
<div id="parsing-a-molecule-to-a-molecular-formula" class="section level2">
<h2 class="hasAnchor">
<a href="#parsing-a-molecule-to-a-molecular-formula" class="anchor"></a>Parsing a Molecule To a Molecular Formula</h2>
<p>Front a molecule, defined as conjunct of atoms helding together by chemical bonds, we can simplify it taking only the information about the atoms. The <code>rcdk</code> package provides a parser to translate molecules to molecular formlulas, the <code>get.mol2formula</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rcdk</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: rcdklibs</code></pre>
<pre><code>## Loading required package: rJava</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.smiles.parser.html">get.smiles.parser</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">molecule</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse.smiles.html">parse.smiles</a></span><span class="op">(</span><span class="st">'N'</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="../reference/convert.implicit.to.explicit.html">convert.implicit.to.explicit</a></span><span class="op">(</span><span class="va">molecule</span><span class="op">)</span>
<span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.mol2formula.html">get.mol2formula</a></span><span class="op">(</span><span class="va">molecule</span>,charge<span class="op">=</span><span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Note that the above formula object is a <code>CDKFormula-class</code>. This class contains some attributes that defines a molecular formula. For example, the mass, the charge, the isotopes, the character representation of the molecular formula and the <a href="https://cdk.github.io/cdk/2.3/docs/api/org/openscience/cdk/interfaces/IMolecularFormula.html">IMolecularFormula</a> <code>jobjRef</code> object.</p>
<p>The molecular mass, charge and string representation for this formula are given by</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span><span class="op">@</span><span class="va">mass</span></code></pre></div>
<pre><code>## [1] 17.02655</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span><span class="op">@</span><span class="va">charge</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span><span class="op">@</span><span class="va">string</span></code></pre></div>
<pre><code>## [1] "H3N"</code></pre>
<p>The isotopes for this formula. It is formed from three attributes. <code>isoto</code> (the symbol expression of the isotope), <code>number</code> (number of atoms for this isotope) and <code>mass</code> (exact mass of this isotope).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span><span class="op">@</span><span class="va">isotopes</span></code></pre></div>
<pre><code>##      isoto number mass         
## [1,] "N"   "1"    "14.003074"  
## [2,] "H"   "3"    "1.007825032"</code></pre>
<p>Depending of the circumstances, you may want to change the charge of the molecular formula.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set.charge.formula.html">set.charge.formula</a></span><span class="op">(</span><span class="va">formula</span>, charge<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="initializing-a-formula-from-the-symbol-expression" class="section level2">
<h2 class="hasAnchor">
<a href="#initializing-a-formula-from-the-symbol-expression" class="anchor"></a>Initializing a Formula from the Symbol Expression</h2>
<p>Other way to create a <code>cdkFormula</code> is from the symbol expression. Thus, setting the characters of the elemental formula, the function <code>get.formula</code> parses it to an object of <code>cdkFormula-class</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.formula.html">get.formula</a></span><span class="op">(</span><span class="st">'NH4'</span>, charge <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">formula</span></code></pre></div>
<pre><code>## cdkFormula:  [H4N]+ , mass =  18.03383 , charge =  1</code></pre>
</div>
<div id="generating-molecular-formula" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-molecular-formula" class="anchor"></a>Generating Molecular Formula</h2>
<p>Mass spectrometry is an essential and reliable technique to determine the molecular mass of compounds. Conversely, one can use the measured mass to identify the compound via its elemental formula. One of the limitations of the method is the precision and accuracy of the instrumentation. As a result, rather than specify exact masses, we specify tolerances or ranges of possible mass, resulting in multiple candidate formulae for a given mass window. The <code>generate.formula</code> function returns a list of formulae which have a given mass (within an error window)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.formula.html">generate.formula</a></span><span class="op">(</span><span class="fl">18.03383</span>, window<span class="op">=</span><span class="fl">1</span>,
    elements<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>,
    validation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">mfSet</span></code></pre></div>
<pre><code>## [[1]]
## cdkFormula:  H4N , mass =  18.03437 , charge =  0 
## 
## [[2]]
## cdkFormula:  CH6 , mass =  18.04695 , charge =  0 
## 
## [[3]]
## cdkFormula:  H18 , mass =  18.14085 , charge =  0</code></pre>
<p>It is important to know if an elemental formula is valid. The method <code>isvalid.formula</code> provides this function. Two constraints can be applied, the <a href="https://en.wikipedia.org/wiki/Nitrogen_rule">nitrogen rule</a> and the <a href="http://fiehnlab.ucdavis.edu/projects/seven-golden-rules/ring-double-bonds">RDBE rule</a> (Ring Double Bond Equivalent).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.formula.html">get.formula</a></span><span class="op">(</span><span class="st">'NH4'</span>, charge <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="../reference/isvalid.formula.html">isvalid.formula</a></span><span class="op">(</span><span class="va">formula</span>,rule<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nitrogen"</span>,<span class="st">"RDBE"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>We can observe that the ammonium is only valid if it is defined with charge of +1.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.formula.html">get.formula</a></span><span class="op">(</span><span class="st">'NH4'</span>, charge <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/isvalid.formula.html">isvalid.formula</a></span><span class="op">(</span><span class="va">formula</span>,rule<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nitrogen"</span>,<span class="st">"RDBE"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The <code>generate.formula</code> method can perform these validation tests during formula generation by setting <code>validation=TRUE</code>. However, this can significantly slow down the process of genersating formulae, especially with larger mass windows. When the default of <code>FALSE</code> is used, nonsensical formulae may be generated, and it’s up to the user to filter them out.</p>
<p>In contrast, the <code>generate.formula.iter</code> method employs the Round Robin formula generation algorithm, which is significantly faster than the default method. In contrast to <code>generate/formula</code>, this method returns an iterator which allows you to process large formula sets without excessive memory usage.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate.formula.iter.html">generate.formula.iter</a></span><span class="op">(</span><span class="fl">100</span>, charge<span class="op">=</span><span class="fl">0</span>, window<span class="op">=</span><span class="fl">0.1</span>,
                             elements<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"H"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"N"</span>,<span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">hit</span> <span class="op">&lt;-</span> <span class="fu">itertools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/itertools/man/ihasNext.html">ihasNext</a></span><span class="op">(</span><span class="va">mit</span><span class="op">)</span>
<span class="kw">while</span> <span class="op">(</span><span class="fu">itertools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/itertools/man/hasNext.html">hasNext</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span><span class="op">)</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">iterators</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/iterators/man/nextElem.html">nextElem</a></span><span class="op">(</span><span class="va">hit</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "[12]C8[1]H4"
## [1] "[12]C7[1]H2[14]N"
## [1] "[12]C6[14]N2"
## [1] "[12]C4[1]H10[14]N3"
## [1] "[12]C3[1]H8[14]N4"
## [1] "[12]C2[1]H6[14]N5"
## [1] "[12]C[1]H4[14]N6"
## [1] "[1]H2[14]N7"</code></pre>
<p>Note that by default, this function will not check for validity of the generated formulae.</p>
</div>
<div id="calculating-isotope-pattern" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-isotope-pattern" class="anchor"></a>Calculating Isotope Pattern</h2>
<p>Due to the measurement errors in medium resolution spectrometry, a given error window can result in a massive number of candidate formulae. The isotope pattern of ions obtained experimentally can be compared with the theoretical ones. The best match is reflected as the most probable elemental formula. <code>rcdk</code> provides the function <code>get.isotope.pattern</code> which predicts the theoretical isotope pattern given a formula.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.formula.html">get.formula</a></span><span class="op">(</span><span class="st">'CHCl3'</span>, charge <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">isotopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.isotopes.pattern.html">get.isotopes.pattern</a></span><span class="op">(</span><span class="va">formula</span>,minAbund<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>
<span class="va">isotopes</span></code></pre></div>
<pre><code>##          mass     abund
## [1,] 117.9144 1.0000000
## [2,] 119.9114 0.9598733
## [3,] 121.9085 0.3071189</code></pre>
<p>In this example we generate a formula for a possible compound with a charge (<span class="math inline">\(z \approx 0\)</span>) containing the standard elements C, H, and Cl. The isotope pattern can be visually inspected, as shown below.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">isotopes</span>, type<span class="op">=</span><span class="st">"h"</span>, xlab<span class="op">=</span><span class="st">"m/z"</span>, ylab<span class="op">=</span><span class="st">"Intensity"</span><span class="op">)</span></code></pre></div>
<p><img src="molform_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rajarshi Guha, Zachary Charlop-Powers.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
